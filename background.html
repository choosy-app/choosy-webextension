<!DOCTYPE html>
<html>
  <head>
    <title>Choosy Chrome</title>
    <script>

      var Choosy = {
        promptAll: function(url, tab) {
          var choosyURL = "x-choosy://prompt.all/" + escape(url);
          chrome.tabs.update(tab.id, {"url": choosyURL});
        }
      };

      chrome.browserAction.onClicked.addListener(function(tab) {
        Choosy.promptAll(tab.url, tab);
      });

      chrome.contextMenus.create({
        title: "Open with Choosy",
        contexts: ["link"],
        onclick: function(info, tab) {
          Choosy.promptAll(info.linkUrl, tab);
        }
      });

    </script>
  </head>
  <body>
  </body>
</html>
